# AWS Deployment Guide - Kite Fighters UI

This guide provides instructions for deploying the Kite Fighters UI application to AWS.

## üìã Table of Contents

- [Environment Setup](#environment-setup)
- [Deployment Options](#deployment-options)
- [Option 1: AWS Amplify (Recommended)](#option-1-aws-amplify-recommended)
- [Option 2: AWS S3 + CloudFront](#option-2-aws-s3--cloudfront)
- [Environment Variables](#environment-variables)
- [Build Commands](#build-commands)
- [Troubleshooting](#troubleshooting)

## üåç Environment Setup

The project now supports separate configurations for development and production:

### Environment Files

- `.env.development` - Local development configuration
- `.env.production` - Production deployment configuration
- `.env.example` - Template for environment variables

### Current Configuration

**Development:**
- API URL: `http://localhost:3000/api/v1`

**Production:**
- API URL: `http://kite-fighter-prod.eba-vnye9xcq.ap-south-1.elasticbeanstalk.com/api/v1`

## üöÄ Deployment Options

### Option 1: AWS Amplify (Recommended)

AWS Amplify provides the easiest way to deploy your React application with CI/CD.

#### Prerequisites
- AWS Account
- GitHub repository connected to Amplify

#### Steps

1. **Login to AWS Console** and navigate to AWS Amplify

2. **Connect Your Repository**
   - Click "New App" ‚Üí "Host web app"
   - Choose GitHub and authorize
   - Select your repository and branch

3. **Configure Build Settings**
   - Amplify will auto-detect the `amplify.yml` file
   - Environment: Production
   - Build settings are already configured in `amplify.yml`

4. **‚ö†Ô∏è IMPORTANT: Add Environment Variables** (REQUIRED)
   
   Navigate to the environment variables:
   - In Amplify Console, click on your app name
   - In the left sidebar, under "Hosting" section, click **"Environment variables"**
   - OR: Go to App ‚Üí **"Environment variables"** tab (next to "Deployments")
   - Click **"Manage variables"** button
   
   Add these required variables:
   ```
   Key: VITE_API_BASE_URL
   Value: http://kite-fighter-prod.eba-vnye9xcq.ap-south-1.elasticbeanstalk.com/api/v1
   
   Key: VITE_ENVIRONMENT
   Value: production
   ```
   
   Click **"Save"** - This will trigger a new deployment automatically.

5. **Deploy**
   - Click "Save and Deploy"
   - Amplify will automatically build and deploy your app
   - You'll get a URL like: `https://main.xxxxx.amplifyapp.com`

#### Amplify Features
- ‚úÖ Automatic deployments on git push
- ‚úÖ Free SSL certificate
- ‚úÖ CDN (CloudFront) distribution
- ‚úÖ Preview environments for PRs
- ‚úÖ Custom domain support

### Option 2: AWS S3 + CloudFront

For more control over your deployment, use S3 for hosting and CloudFront for CDN.

#### Prerequisites
- AWS CLI installed and configured
- AWS account with appropriate permissions

#### Setup Steps

1. **Install AWS CLI** (if not already installed)
   ```bash
   # macOS
   brew install awscli
   
   # Configure AWS credentials
   aws configure
   ```

2. **Create S3 Bucket**
   ```bash
   # Replace with your bucket name
   BUCKET_NAME="kite-fighters-ui-prod"
   REGION="ap-south-1"
   
   # Create bucket
   aws s3 mb s3://${BUCKET_NAME} --region ${REGION}
   
   # Enable static website hosting
   aws s3 website s3://${BUCKET_NAME} --index-document index.html --error-document index.html
   ```

3. **Set Bucket Policy**
   ```bash
   # Update aws-s3-bucket-policy.json with your bucket name
   # Then apply the policy
   aws s3api put-bucket-policy --bucket ${BUCKET_NAME} --policy file://aws-s3-bucket-policy.json
   ```

4. **Create CloudFront Distribution** (Optional but recommended)
   - Go to AWS CloudFront console
   - Create a new distribution
   - Origin: Your S3 bucket website endpoint
   - Viewer Protocol Policy: Redirect HTTP to HTTPS
   - Custom Error Response: 404 ‚Üí /index.html (200) for SPA routing

5. **Deploy Using Script**
   ```bash
   # Make the script executable
   chmod +x deploy-aws.sh
   
   # Update the script with your bucket name and CloudFront ID
   # Then run
   ./deploy-aws.sh
   ```

#### Manual Deployment
```bash
# Build for production
npm run build:prod

# Sync to S3
aws s3 sync dist/ s3://kite-fighters-ui-prod --delete

# Invalidate CloudFront cache (if using CloudFront)
aws cloudfront create-invalidation --distribution-id YOUR_DISTRIBUTION_ID --paths "/*"
```

## üîß Environment Variables

### Adding Environment Variables

Update the respective `.env` file:

```bash
# .env.production
VITE_API_BASE_URL=http://your-api-url.com/api/v1
VITE_ENVIRONMENT=production
```

### Available Variables

- `VITE_API_BASE_URL` - Backend API URL
- `VITE_ENVIRONMENT` - Current environment (development/production)

**Note:** All environment variables must be prefixed with `VITE_` to be accessible in the application.

## üì¶ Build Commands

```bash
# Development build
npm run build:dev

# Production build
npm run build:prod

# Preview production build locally
npm run preview:prod

# Run development server
npm run dev
```

## üîç Troubleshooting

### Issue: API calls failing after deployment

**Solution:** Ensure your API server has CORS configured to allow requests from your frontend domain.

```javascript
// Example Express.js CORS config
app.use(cors({
  origin: [
    'http://localhost:5173',
    'https://your-amplify-domain.amplifyapp.com',
    'https://your-cloudfront-domain.cloudfront.net'
  ]
}));
```

### Issue: Routes return 404 on refresh

**Solution:** Configure your hosting to redirect all routes to `index.html`

- **S3:** Use the `aws-s3-routing-rules.json` configuration
- **Amplify:** Add redirects in `amplify.yml` (already configured)
- **CloudFront:** Add custom error response for 404 ‚Üí /index.html

### Issue: Environment variables not working

**Solution:** 
1. Ensure variables are prefixed with `VITE_`
2. Rebuild the application after changing `.env` files
3. Clear browser cache

### Issue: Build fails with TypeScript errors

**Solution:**
```bash
# Clear TypeScript cache
rm -rf node_modules/.cache

# Reinstall dependencies
npm ci

# Try building again
npm run build:prod
```

## üåê Custom Domain Setup

### For AWS Amplify
1. Go to App Settings ‚Üí Domain management
2. Add your custom domain
3. Follow the DNS configuration steps

### For CloudFront + S3
1. Request SSL certificate in AWS Certificate Manager (ACM)
2. Add custom domain to CloudFront distribution
3. Update your DNS records to point to CloudFront

## üìä Monitoring and Logs

### AWS Amplify
- View build logs in the Amplify console
- Monitor deployment status
- View access logs through CloudWatch

### CloudFront + S3
- Enable CloudFront logging
- Enable S3 server access logging
- Set up CloudWatch alarms for errors

## üîê Security Best Practices

1. **Enable HTTPS** - Always use SSL/TLS
2. **Restrict S3 bucket access** - Use bucket policies wisely
3. **CloudFront** - Use signed URLs for sensitive content
4. **Environment variables** - Never commit `.env.production` with secrets
5. **CORS** - Configure strict CORS policies on your backend

## üí∞ Cost Optimization

- **Amplify:** Free tier includes 1000 build minutes/month
- **S3:** Pay for storage and data transfer
- **CloudFront:** Free tier includes 1TB data transfer/month for first year

## üìö Additional Resources

- [AWS Amplify Documentation](https://docs.amplify.aws/)
- [AWS S3 Static Website Hosting](https://docs.aws.amazon.com/AmazonS3/latest/userguide/WebsiteHosting.html)
- [AWS CloudFront Documentation](https://docs.aws.amazon.com/cloudfront/)
- [Vite Environment Variables](https://vitejs.dev/guide/env-and-mode.html)

## üÜò Support

For issues or questions:
1. Check the troubleshooting section above
2. Review AWS service documentation
3. Check application logs in AWS Console

---

**Last Updated:** January 2026
